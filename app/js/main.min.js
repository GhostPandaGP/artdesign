$(function(){

    // // functions

    // // start quiz
    // let quiz = (nameForms, nameSubmit, nameNumbers = false) => {


    //     if (nameNumbers) return true
    // };

    // $('.quiz-form .slick-arrow').on("click", () => {
    //     console.log('start');
    //     alert($('.quiz-form__asks').slick('slickCurrentSlide'));
    //     alert($('.quiz-form__asks').slick('slickCurrentSlide'));
    // });    
    // // end quiz

    // // modules
    
    // $(".rate-star").rateYo({
    //     rating    : 5,
    //     starWidth: "12px",
    //     rateFill: "#ffa726", 
    //     readOnly: true,
    //   });

    // dropdown-lists start
    $('.header__menu-icon').on('click', () => {
        $('.header__box').slideToggle();
    });

    
    function windowSizeTMP(element, dropDown, width){
        $(element).unbind('click');

        if ($(window).width() <= width){
            $(element).on('click', () => {
                $(dropDown).slideToggle();
            });
        }
    }
    function windowSize(){
        windowSizeTMP('.footer__catalog-title', '.footer__catalog__list-items', '600');
        windowSizeTMP('.aside__title', '.aside__menu', '810');
    }
    $(window).on('load resize', windowSize);
    // dropdown-lists end

    // start sliders
    $('.first-block__slider-items').slick({
        dots: true,
        vertical: true,
        // fade: true,
        arrows: true,
        cssEase: 'linear',
        zIndex: 100,
        pauseOnDotsHover: true,
        verticalSwiping: true,
        infinite: false,
        adaptiveHeight: true,
        autoplay: true,
        autoplaySpeed: 2000,
        appendArrows: $('.first-block__slider-menu'),
        appendDots: $('.first-block__slider-menu'),
        prevArrow: '<button type="button" class="slick-prev">    <?xml version="1.0" encoding="iso-8859-1"?>\n' +
            '    <!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n' +
            '    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n' +
            '          viewBox="0 0 451.846 451.847" style="enable-background:new 0 0 451.846 451.847;"\n' +
            '         xml:space="preserve">\n' +
            '<g>\n' +
            '\t<path d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744\n' +
            '\t\tL278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284\n' +
            '\t\tc6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"/>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '</svg></button>',
        nextArrow: '<button type="button" class="slick-next">    <?xml version="1.0" encoding="iso-8859-1"?>\n' +
            '    <!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n' +
            '    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n' +
            '         viewBox="0 0 451.846 451.847" style="enable-background:new 0 0 451.846 451.847;"\n' +
            '         xml:space="preserve">\n' +
            '<g>\n' +
            '\t<path d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744\n' +
            '\t\tL278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284\n' +
            '\t\tc6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"/>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '        <g>\n' +
            '</g>\n' +
            '</svg></button>',
    });

    $(".product-page__slider-main").slick({
        arrows: false,
        asNavFor: '.product-page__slider-mini',
    });

    $(".product-page__slider-mini").slick({
        arrows: false,
        slidesToShow: 5,
        focusOnSelect: true,
        asNavFor: '.product-page__slider-main',
    });

    $(".add-page__slider-top").slick({
        slidesToShow: 2,
        nextArrow: '<button type="button" class="slick-arrow slick-next"></button>',
        prevArrow: '<button type="button" class="slick-arrow slick-prev"></button>',
        focusOnSelect: true,
        asNavFor: '.add-page__slider-mini',
        responsive: [
            {
                breakpoint: 810,
                settings: {
                    slidesToShow: 1,
                    // centerMode: true,
                },
            }            
        ]
    });

    $(".add-page__slider-mini").slick({
        arrows: false,
        slidesToShow: 5,
        focusOnSelect: true,
        asNavFor: '.add-page__slider-top',
    });
    // end sliders

    // start quiz
    let numberQuiz = 0;
    $('.quiz-form__asks').slick({
        prevArrow: '',
        nextArrow: '<button type="button" class="quiz__btn btn">Далее</button>',
        fade: true,
        infinite: false,
        touchMove: false,
        swipe: false,
        adaptiveHeight: true,
        speed: 100,
        asNavFor: '.quiz-slider__number',
    });

    $('.quiz-slider__number').slick({
        arrows: false,
        fade: true,
        infinite: false,
        touchMove: false,
        swipe: false,
        speed: 100,
        asNavFor: '.quiz-form__asks',
    });

    $('.quiz-slider__total-number').text(" / " + $('.quiz-form__asks .slick-slide').length)

    let lengthQuiz = $('.quiz-form__asks .slick-slide').length;
    let widthSpan = 100 / lengthQuiz + "%";
    for (let i = 0; i < 6; i++){
        $('<span>', {
            css: {
                width: widthSpan
            }
        }).appendTo('.quiz-form__track');
    }

    $('.quiz-form__track span:nth-child(' + ++numberQuiz + ')').addClass('active')
    $('.quiz-form .slick-arrow').on("click", () => {
        $('.quiz-form__track span:nth-child(' + ++numberQuiz + ')').addClass('active');
        if (lengthQuiz - 1 === $('.quiz-form__asks').slick('slickCurrentSlide')) {
            $('.btn.slick-arrow.slick-disabled').hide();
            $('.quiz-form__next .btn').show();
        }
    });
    // end quiz
    
    // start hide/show text
    let oldText = $(".product-page__text").text().trim().replace(/\s+/g, " ");
    hideText = () => {
        $(".product-page__text").text( (i, text) => {
    
            text = oldText;
    
            if (text.length >= 250) {
              text = text.substring(0, 205);
              var lastIndex = text.lastIndexOf(" ");       // позиция последнего пробела
              text = text.substring(0, lastIndex) + '...'; // обрезаем до последнего слова
              $(".product-page__text-box span").addClass("open-more--on");
            }
            
            $(".product-page__text").text(text);
            
          });
    }
    hideText();
    $(".product-page__text-box span").on("click", () => {
        // console.log("-----", $(this));
        if ($(".product-page__text-box span").data("state") === "hide") {
            $(".product-page__text").text(oldText);
            $(".product-page__text-box span").data("state", "show");
            $(".product-page__text-box span").text("Скрыть");
        } else {
            if ($(".product-page__text-box span").data("state") === "show") {
                hideText();
                $(".product-page__text-box span").data("state", "hide");
                $(".product-page__text-box span").text("Читать далее");
            }
        }
        console.log("---", $(".product-page__text-box span").data("state"));
    });
    // end hide/show text

    // start timer
    const 
        second = 1000,
        minute = second * 60,
        hour = minute * 60,
        day = hour * 24;

    let countDown = new Date($(".product-page__timer").data("date")).getTime(),
        x = setInterval(() => {

            let now = new Date().getTime(),
                distance = countDown - now,
                numberDays = Math.floor(distance / (day));

            if (distance > 0) {
                $(".product-page__timer").addClass("product-page__timer--on");
            }

            if (numberDays >= 1){
                $('.product-page__timer-days').text(numberDays);
                $(".product-page__timer").addClass("product-page__timer--long");
            } else {
                $('.product-page__timer-hours').text(Math.floor((distance % (day)) / (hour)));
                $('.product-page__timer-minutes').text(Math.floor((distance % (hour)) / (minute)));
                $('.product-page__timer-seconds').text(Math.floor((distance % (minute)) / second));
                $(".product-page__timer").removeClass("product-page__timer--long");
            }

        }, second)
    // end timer

    // $(".js-range-slider").ionRangeSlider({
    //     type: "double",
    //     min: 0,
    //     max: 1000,
    //     from: 0,
    //     to: 600,
    //     skin: "round",
    //     prefix: "$",
    // });

    // $('.icon-th-list').on('click', () => {
    //     $('.products__item').addClass('list');
        
    //     $('.icon-th-list').addClass('active');
    //     $('.icon-th-large').removeClass('active');
    // });

    // $('.icon-th-large').on('click', () => {
    //     $('.products__item').removeClass('list');

    //     $('.icon-th-large').addClass('active');
    //     $('.icon-th-list').removeClass('active');
    // });

    // let mixer = mixitup('.products__inner-box');
    
    console.log("js loaded");
})